<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizCraft Pro - Interactive Quiz Generator</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-30px); }
            70% { transform: translateY(-15px); }
            90% { transform: translateY(-4px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }
        
        .slide-in { animation: slideIn 0.3s ease-out; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        .bounce-hover:hover { animation: bounce 1s; }
        .pulse-hover:hover { animation: pulse 0.3s ease-in-out; }
        .shake { animation: shake 0.5s ease-in-out; }
        .confetti { animation: confetti 3s ease-out forwards; }
        
        .quiz-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .question-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .question-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .answer-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .answer-option:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        .answer-option.selected {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .answer-option.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        .answer-option.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .quiz-mode {
            display: none;
        }
        
        .quiz-mode.active {
            display: block;
        }
        
        .floating-score {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            animation: fadeIn 0.5s ease-out;
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
            color: #ef4444;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .difficulty-easy { background: #dcfce7; color: #166534; }
        .difficulty-medium { background: #fef3c7; color: #92400e; }
        .difficulty-hard { background: #fee2e2; color: #991b1b; }
        
        .question-type-multiple { border-left: 4px solid #3b82f6; }
        .question-type-true-false { border-left: 4px solid #10b981; }
        .question-type-fill-blank { border-left: 4px solid #f59e0b; }
        .question-type-matching { border-left: 4px solid #8b5cf6; }
        
        .drag-over {
            border: 2px dashed #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .export-format {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .export-format:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .leaderboard-item {
            transition: all 0.2s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .medal-gold { color: #fbbf24; }
        .medal-silver { color: #9ca3af; }
        .medal-bronze { color: #d97706; }
    </style>
</head>
<body class="quiz-bg min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-3xl font-bold text-gray-800">üß† QuizCraft Pro</h1>
                    <div class="text-sm text-gray-600">Interactive Quiz Generator</div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="switchMode('builder')" id="builderBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        üõ†Ô∏è Builder
                    </button>
                    <button onclick="switchMode('library')" id="libraryBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        üìö Library
                    </button>
                    <button onclick="switchMode('take')" id="takeBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        ‚úèÔ∏è Take Quiz
                    </button>
                    <button onclick="switchMode('stats')" id="statsBtn" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                        üìä Stats
                    </button>
                    <button onclick="window.location.href='main.html'" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        ‚¨ÖÔ∏è Back to Main
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Builder Mode -->
    <div id="builderMode" class="quiz-mode active">
        <div class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Panel - Quiz Settings -->
                <div class="glass-panel rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üìù Quiz Settings</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Quiz Title</label>
                            <input type="text" id="quizTitle" placeholder="Enter quiz title..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Description</label>
                            <textarea id="quizDescription" placeholder="Brief description of your quiz..." class="w-full p-3 border rounded-lg h-20 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Category</label>
                                <select id="quizCategory" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="general">General Knowledge</option>
                                    <option value="science">Science</option>
                                    <option value="history">History</option>
                                    <option value="geography">Geography</option>
                                    <option value="literature">Literature</option>
                                    <option value="math">Mathematics</option>
                                    <option value="technology">Technology</option>
                                    <option value="sports">Sports</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Difficulty</label>
                                <select id="quizDifficulty" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="easy">Easy</option>
                                    <option value="medium">Medium</option>
                                    <option value="hard">Hard</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Time Limit (minutes)</label>
                                <input type="number" id="timeLimit" min="1" max="120" value="10" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Passing Score (%)</label>
                                <input type="number" id="passingScore" min="0" max="100" value="70" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="shuffleQuestions" class="mr-2">
                                <span class="text-sm">Shuffle Questions</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="showCorrectAnswers" class="mr-2" checked>
                                <span class="text-sm">Show Correct Answers</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="allowRetake" class="mr-2" checked>
                                <span class="text-sm">Allow Retakes</span>
                            </label>
                        </div>
                        
                        <div class="pt-4 border-t space-y-2">
                            <button onclick="saveQuiz()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors pulse-hover">
                                üíæ Save Quiz
                            </button>
                            <button onclick="previewQuiz()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                üëÅÔ∏è Preview Quiz
                            </button>
                            <button onclick="exportQuiz()" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors">
                                üì§ Export Quiz
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Middle Panel - Question Builder -->
                <div class="glass-panel rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">‚ùì Question Builder</h2>
                        <div class="text-sm text-gray-600">
                            <span id="questionCount">0</span> questions
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Question Type</label>
                            <select id="questionType" onchange="updateQuestionBuilder()" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="multiple">Multiple Choice</option>
                                <option value="true-false">True/False</option>
                                <option value="fill-blank">Fill in the Blank</option>
                                <option value="matching">Matching</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Question Text</label>
                            <textarea id="questionText" placeholder="Enter your question here..." class="w-full p-3 border rounded-lg h-20 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div id="questionBuilder">
                            <!-- Dynamic question builder content -->
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Points</label>
                                <input type="number" id="questionPoints" min="1" max="10" value="1" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Time (seconds)</label>
                                <input type="number" id="questionTime" min="10" max="300" value="30" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Explanation (Optional)</label>
                            <textarea id="questionExplanation" placeholder="Explain the correct answer..." class="w-full p-3 border rounded-lg h-16 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="addQuestion()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                                ‚ûï Add Question
                            </button>
                            <button onclick="clearQuestion()" class="bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Right Panel - Questions List -->
                <div class="glass-panel rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">üìã Questions List</h2>
                    
                    <div id="questionsList" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-4xl mb-3">üìù</div>
                            <div class="text-lg">No questions yet</div>
                            <div class="text-sm">Add your first question to get started</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Library Mode -->
    <div id="libraryMode" class="quiz-mode">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-bold text-white">üìö Quiz Library</h2>
                <div class="flex items-center space-x-4">
                    <input type="text" id="searchQuizzes" placeholder="Search quizzes..." class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <select id="filterCategory" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Categories</option>
                        <option value="general">General Knowledge</option>
                        <option value="science">Science</option>
                        <option value="history">History</option>
                        <option value="geography">Geography</option>
                        <option value="literature">Literature</option>
                        <option value="math">Mathematics</option>
                        <option value="technology">Technology</option>
                        <option value="sports">Sports</option>
                        <option value="entertainment">Entertainment</option>
                    </select>
                </div>
            </div>
            
            <div id="quizLibrary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Quiz cards will be populated here -->
            </div>
        </div>
    </div>

    <!-- Take Quiz Mode -->
    <div id="takeMode" class="quiz-mode">
        <div class="container mx-auto px-6 py-8">
            <!-- Quiz Selection -->
            <div id="quizSelection" class="glass-panel rounded-xl p-8 max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">üéØ Select a Quiz</h2>
                
                <div id="availableQuizzes" class="space-y-4">
                    <!-- Available quizzes will be listed here -->
                </div>
            </div>
            
            <!-- Quiz Taking Interface -->
            <div id="quizInterface" class="hidden">
                <!-- Quiz Header -->
                <div class="glass-panel rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 id="currentQuizTitle" class="text-2xl font-bold text-gray-800"></h2>
                            <div class="text-sm text-gray-600">
                                Question <span id="currentQuestionNumber">1</span> of <span id="totalQuestions">10</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" id="currentScore">0</div>
                                <div class="text-xs text-gray-600">Score</div>
                            </div>
                            
                            <div class="text-center">
                                <div class="text-2xl font-bold" id="timeRemaining">10:00</div>
                                <div class="text-xs text-gray-600">Time Left</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="progress-bar bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Question Display -->
                <div class="glass-panel rounded-xl p-8">
                    <div id="questionDisplay">
                        <!-- Current question will be displayed here -->
                    </div>
                    
                    <div class="flex justify-between mt-8">
                        <button onclick="previousQuestion()" id="prevBtn" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50" disabled>
                            ‚Üê Previous
                        </button>
                        
                        <button onclick="nextQuestion()" id="nextBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Next ‚Üí
                        </button>
                        
                        <button onclick="submitQuiz()" id="submitBtn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors hidden">
                            Submit Quiz
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Quiz Results -->
            <div id="quizResults" class="hidden glass-panel rounded-xl p-8 max-w-2xl mx-auto">
                <div class="text-center">
                    <div id="resultIcon" class="text-6xl mb-4">üéâ</div>
                    <h2 class="text-3xl font-bold mb-4 text-gray-800">Quiz Complete!</h2>
                    
                    <div class="grid grid-cols-3 gap-6 mb-8">
                        <div class="stats-card rounded-lg p-4">
                            <div class="text-2xl font-bold" id="finalScore">0</div>
                            <div class="text-sm opacity-80">Final Score</div>
                        </div>
                        
                        <div class="stats-card rounded-lg p-4">
                            <div class="text-2xl font-bold" id="correctAnswers">0</div>
                            <div class="text-sm opacity-80">Correct</div>
                        </div>
                        
                        <div class="stats-card rounded-lg p-4">
                            <div class="text-2xl font-bold" id="timeTaken">0:00</div>
                            <div class="text-sm opacity-80">Time Taken</div>
                        </div>
                    </div>
                    
                    <div id="passingMessage" class="text-lg mb-6"></div>
                    
                    <div class="space-y-3">
                        <button onclick="reviewAnswers()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            üìù Review Answers
                        </button>
                        <button onclick="retakeQuiz()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                            üîÑ Retake Quiz
                        </button>
                        <button onclick="backToSelection()" class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">
                            üìö Back to Library
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Mode -->
    <div id="statsMode" class="quiz-mode">
        <div class="container mx-auto px-6 py-8">
            <h2 class="text-3xl font-bold text-white mb-8">üìä Quiz Statistics</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stats-card rounded-xl p-6">
                    <div class="text-3xl font-bold" id="totalQuizzesCreated">0</div>
                    <div class="text-sm opacity-80">Quizzes Created</div>
                </div>
                
                <div class="stats-card rounded-xl p-6">
                    <div class="text-3xl font-bold" id="totalQuizzesTaken">0</div>
                    <div class="text-sm opacity-80">Quizzes Taken</div>
                </div>
                
                <div class="stats-card rounded-xl p-6">
                    <div class="text-3xl font-bold" id="averageScore">0%</div>
                    <div class="text-sm opacity-80">Average Score</div>
                </div>
                
                <div class="stats-card rounded-xl p-6">
                    <div class="text-3xl font-bold" id="bestScore">0%</div>
                    <div class="text-sm opacity-80">Best Score</div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Recent Activity -->
                <div class="glass-panel rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üìà Recent Activity</h3>
                    <div id="recentActivity" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-3xl mb-2">üìä</div>
                            <div>No activity yet</div>
                        </div>
                    </div>
                </div>
                
                <!-- Leaderboard -->
                <div class="glass-panel rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">üèÜ Leaderboard</h3>
                    <div id="leaderboard" class="space-y-2">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-3xl mb-2">üèÜ</div>
                            <div>No scores yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-6">üì§ Export Quiz</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Export Format</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="export-format border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectExportFormat('json')">
                            <div class="text-2xl mb-2">üìÑ</div>
                            <div class="text-sm font-medium">JSON</div>
                        </div>
                        <div class="export-format border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectExportFormat('pdf')">
                            <div class="text-2xl mb-2">üìã</div>
                            <div class="text-sm font-medium">PDF</div>
                        </div>
                        <div class="export-format border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectExportFormat('csv')">
                            <div class="text-2xl mb-2">üìä</div>
                            <div class="text-sm font-medium">CSV</div>
                        </div>
                        <div class="export-format border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectExportFormat('html')">
                            <div class="text-2xl mb-2">üåê</div>
                            <div class="text-sm font-medium">HTML</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="confirmExport()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
                        üì§ Export
                    </button>
                    <button onclick="closeExportModal()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Global state
        let currentQuiz = {
            title: '',
            description: '',
            category: 'general',
            difficulty: 'easy',
            timeLimit: 10,
            passingScore: 70,
            shuffleQuestions: false,
            showCorrectAnswers: true,
            allowRetake: true,
            questions: []
        };
        
        let quizLibrary = [];
        let currentQuizSession = null;
        let quizTimer = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizStartTime = null;
        let selectedExportFormat = 'json';
        
        // Sample quizzes for demonstration
        const sampleQuizzes = [
            {
                id: 'sample-1',
                title: 'General Knowledge Quiz',
                description: 'Test your general knowledge with this fun quiz!',
                category: 'general',
                difficulty: 'easy',
                timeLimit: 5,
                passingScore: 70,
                questions: [
                    {
                        type: 'multiple',
                        text: 'What is the capital of France?',
                        options: ['London', 'Berlin', 'Paris', 'Madrid'],
                        correct: 2,
                        points: 1,
                        explanation: 'Paris is the capital and largest city of France.'
                    },
                    {
                        type: 'true-false',
                        text: 'The Earth is flat.',
                        correct: false,
                        points: 1,
                        explanation: 'The Earth is actually round (spherical).'
                    },
                    {
                        type: 'multiple',
                        text: 'Which planet is known as the Red Planet?',
                        options: ['Venus', 'Mars', 'Jupiter', 'Saturn'],
                        correct: 1,
                        points: 1,
                        explanation: 'Mars is called the Red Planet due to its reddish appearance.'
                    }
                ]
            },
            {
                id: 'sample-2',
                title: 'Science Basics',
                description: 'Fundamental science concepts for beginners',
                category: 'science',
                difficulty: 'medium',
                timeLimit: 8,
                passingScore: 75,
                questions: [
                    {
                        type: 'multiple',
                        text: 'What is H2O commonly known as?',
                        options: ['Oxygen', 'Hydrogen', 'Water', 'Carbon Dioxide'],
                        correct: 2,
                        points: 1,
                        explanation: 'H2O is the chemical formula for water.'
                    },
                    {
                        type: 'fill-blank',
                        text: 'The process by which plants make food is called ____.',
                        correct: 'photosynthesis',
                        points: 2,
                        explanation: 'Photosynthesis is how plants convert sunlight into energy.'
                    }
                ]
            }
        ];
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadSampleQuizzes();
            updateQuestionBuilder();
            populateQuizLibrary();
            populateAvailableQuizzes();
            updateStats();
            showNotification('üß† Welcome to QuizCraft Pro!', 'success');
        });
        
        function loadSampleQuizzes() {
            quizLibrary = [...sampleQuizzes];
            localStorage.setItem('quizLibrary', JSON.stringify(quizLibrary));
        }
        
        // Mode switching
        function switchMode(mode) {
            // Hide all modes
            document.querySelectorAll('.quiz-mode').forEach(m => m.classList.remove('active'));
            
            // Update button states
            document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                btn.className = btn.className.replace('bg-blue-600', 'bg-gray-600');
            });
            
            // Show selected mode
            document.getElementById(mode + 'Mode').classList.add('active');
            document.getElementById(mode + 'Btn').className = document.getElementById(mode + 'Btn').className.replace('bg-gray-600', 'bg-blue-600');
            
            // Mode-specific actions
            switch(mode) {
                case 'library':
                    populateQuizLibrary();
                    break;
                case 'take':
                    populateAvailableQuizzes();
                    resetQuizInterface();
                    break;
                case 'stats':
                    updateStats();
                    break;
            }
        }
        
        // Question builder
        function updateQuestionBuilder() {
            const questionType = document.getElementById('questionType').value;
            const builder = document.getElementById('questionBuilder');
            
            switch(questionType) {
                case 'multiple':
                    builder.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2">Answer Options</label>
                            <div class="space-y-2">
                                <div class="flex items-center space-x-2">
                                    <input type="radio" name="correctAnswer" value="0" class="text-blue-600">
                                    <input type="text" placeholder="Option A" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="option0">
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="radio" name="correctAnswer" value="1" class="text-blue-600">
                                    <input type="text" placeholder="Option B" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="option1">
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="radio" name="correctAnswer" value="2" class="text-blue-600">
                                    <input type="text" placeholder="Option C" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="option2">
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="radio" name="correctAnswer" value="3" class="text-blue-600">
                                    <input type="text" placeholder="Option D" class="flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="option3">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'true-false':
                    builder.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2">Correct Answer</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="correctAnswer" value="true" class="mr-2 text-blue-600">
                                    <span>True</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="correctAnswer" value="false" class="mr-2 text-blue-600">
                                    <span>False</span>
                                </label>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'fill-blank':
                    builder.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2">Correct Answer</label>
                            <input type="text" id="correctAnswer" placeholder="Enter the correct answer..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="text-xs text-gray-500 mt-1">Use ____ in your question to indicate where the blank should be</div>
                        </div>
                    `;
                    break;
                    
                case 'matching':
                    builder.innerHTML = `
                        <div>
                            <label class="block text-sm font-medium mb-2">Matching Pairs</label>
                            <div class="space-y-2">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" placeholder="Item 1" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="item0">
                                    <input type="text" placeholder="Match 1" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="match0">
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" placeholder="Item 2" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="item1">
                                    <input type="text" placeholder="Match 2" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="match1">
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="text" placeholder="Item 3" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="item2">
                                    <input type="text" placeholder="Match 3" class="p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="match2">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }
        
        function addQuestion() {
            const questionType = document.getElementById('questionType').value;
            const questionText = document.getElementById('questionText').value.trim();
            const questionPoints = parseInt(document.getElementById('questionPoints').value);
            const questionTime = parseInt(document.getElementById('questionTime').value);
            const questionExplanation = document.getElementById('questionExplanation').value.trim();
            
            if (!questionText) {
                showNotification('‚ö†Ô∏è Please enter a question!', 'warning');
                return;
            }
            
            let question = {
                type: questionType,
                text: questionText,
                points: questionPoints,
                time: questionTime,
                explanation: questionExplanation
            };
            
            // Get answer data based on question type
            switch(questionType) {
                case 'multiple':
                    const options = [];
                    for (let i = 0; i < 4; i++) {
                        const option = document.getElementById(`option${i}`).value.trim();
                        if (!option) {
                            showNotification(`‚ö†Ô∏è Please fill in all options!`, 'warning');
                            return;
                        }
                        options.push(option);
                    }
                    
                    const correctAnswer = document.querySelector('input[name="correctAnswer"]:checked');
                    if (!correctAnswer) {
                        showNotification('‚ö†Ô∏è Please select the correct answer!', 'warning');
                        return;
                    }
                    
                    question.options = options;
                    question.correct = parseInt(correctAnswer.value);
                    break;
                    
                case 'true-false':
                    const tfAnswer = document.querySelector('input[name="correctAnswer"]:checked');
                    if (!tfAnswer) {
                        showNotification('‚ö†Ô∏è Please select True or False!', 'warning');
                        return;
                    }
                    question.correct = tfAnswer.value === 'true';
                    break;
                    
                case 'fill-blank':
                    const correctAnswerText = document.getElementById('correctAnswer').value.trim();
                    if (!correctAnswerText) {
                        showNotification('‚ö†Ô∏è Please enter the correct answer!', 'warning');
                        return;
                    }
                    question.correct = correctAnswerText;
                    break;
                    
                case 'matching':
                    const items = [];
                    const matches = [];
                    for (let i = 0; i < 3; i++) {
                        const item = document.getElementById(`item${i}`).value.trim();
                        const match = document.getElementById(`match${i}`).value.trim();
                        if (!item || !match) {
                            showNotification('‚ö†Ô∏è Please fill in all matching pairs!', 'warning');
                            return;
                        }
                        items.push(item);
                        matches.push(match);
                    }
                    question.items = items;
                    question.matches = matches;
                    break;
            }
            
            currentQuiz.questions.push(question);
            updateQuestionsList();
            clearQuestion();
            showNotification('‚úÖ Question added successfully!', 'success');
        }
        
        function clearQuestion() {
            document.getElementById('questionText').value = '';
            document.getElementById('questionPoints').value = '1';
            document.getElementById('questionTime').value = '30';
            document.getElementById('questionExplanation').value = '';
            updateQuestionBuilder();
        }
        
        function updateQuestionsList() {
            const questionsList = document.getElementById('questionsList');
            const questionCount = document.getElementById('questionCount');
            
            questionCount.textContent = currentQuiz.questions.length;
            
            if (currentQuiz.questions.length === 0) {
                questionsList.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-4xl mb-3">üìù</div>
                        <div class="text-lg">No questions yet</div>
                        <div class="text-sm">Add your first question to get started</div>
                    </div>
                `;
                return;
            }
            
            questionsList.innerHTML = currentQuiz.questions.map((question, index) => `
                <div class="question-card bg-white border rounded-lg p-4 question-type-${question.type}">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="category-badge difficulty-${currentQuiz.difficulty}">${question.type.replace('-', ' ')}</span>
                                <span class="text-xs text-gray-500">${question.points} pts</span>
                                <span class="text-xs text-gray-500">${question.time}s</span>
                            </div>
                            <div class="font-medium text-gray-800 mb-2">${question.text}</div>
                            <div class="text-sm text-gray-600">
                                ${getQuestionPreview(question)}
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editQuestion(${index})" class="text-blue-600 hover:bg-blue-50 p-2 rounded">
                                ‚úèÔ∏è
                            </button>
                            <button onclick="deleteQuestion(${index})" class="text-red-600 hover:bg-red-50 p-2 rounded">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function getQuestionPreview(question) {
            switch(question.type) {
                case 'multiple':
                    return `Options: ${question.options.join(', ')}`;
                case 'true-false':
                    return `Answer: ${question.correct ? 'True' : 'False'}`;
                case 'fill-blank':
                    return `Answer: ${question.correct}`;
                case 'matching':
                    return `${question.items.length} pairs to match`;
                default:
                    return '';
            }
        }
        
        function editQuestion(index) {
            // Implementation for editing questions
            showNotification('‚úèÔ∏è Edit functionality coming soon!', 'info');
        }
        
        function deleteQuestion(index) {
            if (confirm('Are you sure you want to delete this question?')) {
                currentQuiz.questions.splice(index, 1);
                updateQuestionsList();
                showNotification('üóëÔ∏è Question deleted!', 'success');
            }
        }
        
        // Quiz management
        function saveQuiz() {
            const title = document.getElementById('quizTitle').value.trim();
            const description = document.getElementById('quizDescription').value.trim();
            
            if (!title) {
                showNotification('‚ö†Ô∏è Please enter a quiz title!', 'warning');
                return;
            }
            
            if (currentQuiz.questions.length === 0) {
                showNotification('‚ö†Ô∏è Please add at least one question!', 'warning');
                return;
            }
            
            // Update quiz settings
            currentQuiz.title = title;
            currentQuiz.description = description;
            currentQuiz.category = document.getElementById('quizCategory').value;
            currentQuiz.difficulty = document.getElementById('quizDifficulty').value;
            currentQuiz.timeLimit = parseInt(document.getElementById('timeLimit').value);
            currentQuiz.passingScore = parseInt(document.getElementById('passingScore').value);
            currentQuiz.shuffleQuestions = document.getElementById('shuffleQuestions').checked;
            currentQuiz.showCorrectAnswers = document.getElementById('showCorrectAnswers').checked;
            currentQuiz.allowRetake = document.getElementById('allowRetake').checked;
            currentQuiz.id = 'quiz-' + Date.now();
            currentQuiz.created = new Date().toISOString();
            
            // Save to library
            quizLibrary.push({...currentQuiz});
            localStorage.setItem('quizLibrary', JSON.stringify(quizLibrary));
            
            showNotification('üíæ Quiz saved successfully!', 'success');
            
            // Reset current quiz
            currentQuiz = {
                title: '',
                description: '',
                category: 'general',
                difficulty: 'easy',
                timeLimit: 10,
                passingScore: 70,
                shuffleQuestions: false,
                showCorrectAnswers: true,
                allowRetake: true,
                questions: []
            };
            
            // Clear form
            document.getElementById('quizTitle').value = '';
            document.getElementById('quizDescription').value = '';
            updateQuestionsList();
        }
        
        function previewQuiz() {
            if (currentQuiz.questions.length === 0) {
                showNotification('‚ö†Ô∏è Add some questions first!', 'warning');
                return;
            }
            
            showNotification('üëÅÔ∏è Preview mode coming soon!', 'info');
        }
        
        function exportQuiz() {
            if (currentQuiz.questions.length === 0) {
                showNotification('‚ö†Ô∏è Add some questions first!', 'warning');
                return;
            }
            
            document.getElementById('exportModal').classList.remove('hidden');
        }
        
        function selectExportFormat(format) {
            document.querySelectorAll('.export-format').forEach(el => {
                el.classList.remove('border-blue-500', 'bg-blue-50');
                el.classList.add('border-gray-200');
            });
            
            event.target.closest('.export-format').classList.remove('border-gray-200');
            event.target.closest('.export-format').classList.add('border-blue-500', 'bg-blue-50');
            
            selectedExportFormat = format;
        }
        
        function confirmExport() {
            const quiz = {
                ...currentQuiz,
                title: document.getElementById('quizTitle').value || 'Untitled Quiz'
            };
            
            let content = '';
            let filename = '';
            let mimeType = '';
            
            switch(selectedExportFormat) {
                case 'json':
                    content = JSON.stringify(quiz, null, 2);
                    filename = `${quiz.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
                    mimeType = 'application/json';
                    break;
                    
                case 'csv':
                    content = generateCSV(quiz);
                    filename = `${quiz.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.csv`;
                    mimeType = 'text/csv';
                    break;
                    
                case 'html':
                    content = generateHTML(quiz);
                    filename = `${quiz.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.html`;
                    mimeType = 'text/html';
                    break;
                    
                case 'pdf':
                    showNotification('üìã PDF export coming soon!', 'info');
                    closeExportModal();
                    return;
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification(`üì§ Quiz exported as ${selectedExportFormat.toUpperCase()}!`, 'success');
            closeExportModal();
        }
        
        function generateCSV(quiz) {
            let csv = 'Question,Type,Options,Correct Answer,Points,Explanation\n';
            
            quiz.questions.forEach(q => {
                const options = q.options ? q.options.join(';') : '';
                const correct = q.type === 'multiple' ? q.options[q.correct] : q.correct;
                csv += `"${q.text}","${q.type}","${options}","${correct}",${q.points},"${q.explanation || ''}"\n`;
            });
            
            return csv;
        }
        
        function generateHTML(quiz) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${quiz.title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                        .question { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
                        .options { margin: 10px 0; }
                        .correct { color: green; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>${quiz.title}</h1>
                    <p>${quiz.description}</p>
                    <p><strong>Category:</strong> ${quiz.category} | <strong>Difficulty:</strong> ${quiz.difficulty}</p>
                    
                    ${quiz.questions.map((q, i) => `
                        <div class="question">
                            <h3>Question ${i + 1}: ${q.text}</h3>
                            ${q.options ? `
                                <div class="options">
                                    ${q.options.map((opt, j) => `
                                        <div ${j === q.correct ? 'class="correct"' : ''}>${String.fromCharCode(65 + j)}. ${opt}</div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="correct">Answer: ${q.correct}</div>
                            `}
                            ${q.explanation ? `<p><em>Explanation: ${q.explanation}</em></p>` : ''}
                        </div>
                    `).join('')}
                </body>
                </html>
            `;
        }
        
        function closeExportModal() {
            document.getElementById('exportModal').classList.add('hidden');
        }
        
        // Quiz library
        function populateQuizLibrary() {
            const library = document.getElementById('quizLibrary');
            const savedQuizzes = JSON.parse(localStorage.getItem('quizLibrary') || '[]');
            const allQuizzes = [...sampleQuizzes, ...savedQuizzes.filter(q => !sampleQuizzes.find(s => s.id === q.id))];
            
            if (allQuizzes.length === 0) {
                library.innerHTML = `
                    <div class="col-span-full text-center text-white py-12">
                        <div class="text-6xl mb-4">üìö</div>
                        <div class="text-2xl mb-2">No quizzes yet</div>
                        <div class="text-lg opacity-80">Create your first quiz to get started!</div>
                    </div>
                `;
                return;
            }
            
            library.innerHTML = allQuizzes.map(quiz => `
                <div class="glass-panel rounded-xl p-6 question-card">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${quiz.title}</h3>
                            <p class="text-gray-600 text-sm mb-3">${quiz.description}</p>
                        </div>
                        <span class="category-badge difficulty-${quiz.difficulty}">${quiz.difficulty}</span>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm text-gray-600 mb-4">
                        <span>üìÇ ${quiz.category}</span>
                        <span>‚ùì ${quiz.questions.length} questions</span>
                        <span>‚è±Ô∏è ${quiz.timeLimit} min</span>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="takeQuizFromLibrary('${quiz.id}')" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                            ‚úèÔ∏è Take Quiz
                        </button>
                        <button onclick="duplicateQuiz('${quiz.id}')" class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            üìã
                        </button>
                        ${!quiz.id.startsWith('sample-') ? `
                            <button onclick="deleteQuizFromLibrary('${quiz.id}')" class="bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                üóëÔ∏è
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function takeQuizFromLibrary(quizId) {
            switchMode('take');
            startQuiz(quizId);
        }
        
        function duplicateQuiz(quizId) {
            const allQuizzes = [...sampleQuizzes, ...JSON.parse(localStorage.getItem('quizLibrary') || '[]')];
            const quiz = allQuizzes.find(q => q.id === quizId);
            
            if (quiz) {
                currentQuiz = {
                    ...quiz,
                    title: quiz.title + ' (Copy)',
                    id: undefined,
                    created: undefined
                };
                
                // Switch to builder and populate form
                switchMode('builder');
                document.getElementById('quizTitle').value = currentQuiz.title;
                document.getElementById('quizDescription').value = currentQuiz.description;
                document.getElementById('quizCategory').value = currentQuiz.category;
                document.getElementById('quizDifficulty').value = currentQuiz.difficulty;
                document.getElementById('timeLimit').value = currentQuiz.timeLimit;
                document.getElementById('passingScore').value = currentQuiz.passingScore;
                document.getElementById('shuffleQuestions').checked = currentQuiz.shuffleQuestions;
                document.getElementById('showCorrectAnswers').checked = currentQuiz.showCorrectAnswers;
                document.getElementById('allowRetake').checked = currentQuiz.allowRetake;
                
                updateQuestionsList();
                showNotification('üìã Quiz duplicated! You can now edit it.', 'success');
            }
        }
        
        function deleteQuizFromLibrary(quizId) {
            if (confirm('Are you sure you want to delete this quiz?')) {
                let savedQuizzes = JSON.parse(localStorage.getItem('quizLibrary') || '[]');
                savedQuizzes = savedQuizzes.filter(q => q.id !== quizId);
                localStorage.setItem('quizLibrary', JSON.stringify(savedQuizzes));
                populateQuizLibrary();
                showNotification('üóëÔ∏è Quiz deleted!', 'success');
            }
        }
        
        // Quiz taking
        function populateAvailableQuizzes() {
            const container = document.getElementById('availableQuizzes');
            const allQuizzes = [...sampleQuizzes, ...JSON.parse(localStorage.getItem('quizLibrary') || '[]')];
            
            if (allQuizzes.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-4xl mb-3">üìö</div>
                        <div class="text-lg">No quizzes available</div>
                        <div class="text-sm">Create a quiz first!</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = allQuizzes.map(quiz => `
                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="startQuiz('${quiz.id}')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-lg">${quiz.title}</h3>
                            <p class="text-gray-600 text-sm">${quiz.description}</p>
                            <div class="flex items-center space-x-4 text-xs text-gray-500 mt-2">
                                <span>üìÇ ${quiz.category}</span>
                                <span>‚ùì ${quiz.questions.length} questions</span>
                                <span>‚è±Ô∏è ${quiz.timeLimit} minutes</span>
                                <span class="category-badge difficulty-${quiz.difficulty}">${quiz.difficulty}</span>
                            </div>
                        </div>
                        <div class="text-2xl">‚ñ∂Ô∏è</div>
                    </div>
                </div>
            `).join('');
        }
        
        function startQuiz(quizId) {
            const allQuizzes = [...sampleQuizzes, ...JSON.parse(localStorage.getItem('quizLibrary') || '[]')];
            const quiz = allQuizzes.find(q => q.id === quizId);
            
            if (!quiz) {
                showNotification('‚ùå Quiz not found!', 'error');
                return;
            }
            
            currentQuizSession = {
                quiz: quiz,
                questions: quiz.shuffleQuestions ? shuffleArray([...quiz.questions]) : [...quiz.questions],
                currentIndex: 0,
                answers: [],
                score: 0,
                startTime: Date.now(),
                timeRemaining: quiz.timeLimit * 60
            };
            
            userAnswers = new Array(currentQuizSession.questions.length).fill(null);
            currentQuestionIndex = 0;
            
            // Hide selection, show interface
            document.getElementById('quizSelection').classList.add('hidden');
            document.getElementById('quizInterface').classList.remove('hidden');
            
            // Setup quiz interface
            document.getElementById('currentQuizTitle').textContent = quiz.title;
            document.getElementById('totalQuestions').textContent = currentQuizSession.questions.length;
            document.getElementById('currentScore').textContent = '0';
            
            // Start timer
            startQuizTimer();
            
            // Show first question
            showQuestion(0);
            
            showNotification('üöÄ Quiz started! Good luck!', 'success');
        }
        
        function startQuizTimer() {
            const timeDisplay = document.getElementById('timeRemaining');
            
            quizTimer = setInterval(() => {
                currentQuizSession.timeRemaining--;
                
                const minutes = Math.floor(currentQuizSession.timeRemaining / 60);
                const seconds = currentQuizSession.timeRemaining % 60;
                
                timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Warning when less than 1 minute
                if (currentQuizSession.timeRemaining <= 60) {
                    timeDisplay.classList.add('timer-warning');
                }
                
                // Auto-submit when time runs out
                if (currentQuizSession.timeRemaining <= 0) {
                    clearInterval(quizTimer);
                    submitQuiz();
                }
            }, 1000);
        }
        
        function showQuestion(index) {
            const question = currentQuizSession.questions[index];
            const display = document.getElementById('questionDisplay');
            
            currentQuestionIndex = index;
            
            // Update progress
            document.getElementById('currentQuestionNumber').textContent = index + 1;
            const progress = ((index + 1) / currentQuizSession.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').classList.toggle('hidden', index === currentQuizSession.questions.length - 1);
            document.getElementById('submitBtn').classList.toggle('hidden', index !== currentQuizSession.questions.length - 1);
            
            let questionHTML = `
                <div class="mb-6">
                    <h3 class="text-2xl font-bold mb-4">${question.text}</h3>
                </div>
            `;
            
            switch(question.type) {
                case 'multiple':
                    questionHTML += `
                        <div class="space-y-3">
                            ${question.options.map((option, i) => `
                                <div class="answer-option border-2 border-gray-200 rounded-lg p-4 ${userAnswers[index] === i ? 'selected' : ''}" onclick="selectAnswer(${i})">
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center ${userAnswers[index] === i ? 'bg-blue-600 border-blue-600' : ''}">
                                            ${userAnswers[index] === i ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                                        </div>
                                        <span class="text-lg">${option}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                    
                case 'true-false':
                    questionHTML += `
                        <div class="space-y-3">
                            <div class="answer-option border-2 border-gray-200 rounded-lg p-4 ${userAnswers[index] === true ? 'selected' : ''}" onclick="selectAnswer(true)">
                                <div class="flex items-center">
                                    <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center ${userAnswers[index] === true ? 'bg-blue-600 border-blue-600' : ''}">
                                        ${userAnswers[index] === true ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                                    </div>
                                    <span class="text-lg">True</span>
                                </div>
                            </div>
                            <div class="answer-option border-2 border-gray-200 rounded-lg p-4 ${userAnswers[index] === false ? 'selected' : ''}" onclick="selectAnswer(false)">
                                <div class="flex items-center">
                                    <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center ${userAnswers[index] === false ? 'bg-blue-600 border-blue-600' : ''}">
                                        ${userAnswers[index] === false ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                                    </div>
                                    <span class="text-lg">False</span>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'fill-blank':
                    questionHTML += `
                        <div>
                            <input type="text" id="fillBlankAnswer" placeholder="Enter your answer..." 
                                   class="w-full p-4 border-2 border-gray-200 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   value="${userAnswers[index] || ''}" onchange="selectAnswer(this.value)">
                        </div>
                    `;
                    break;
                    
                case 'matching':
                    // Simplified matching for demo
                    questionHTML += `
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-3xl mb-2">üîÑ</div>
                            <div>Matching questions coming soon!</div>
                        </div>
                    `;
                    break;
            }
            
            display.innerHTML = questionHTML;
        }
        
        function selectAnswer(answer) {
            userAnswers[currentQuestionIndex] = answer;
            
            // Update display for current question type
            const question = currentQuizSession.questions[currentQuestionIndex];
            
            if (question.type === 'multiple' || question.type === 'true-false') {
                // Remove all selected classes
                document.querySelectorAll('.answer-option').forEach(el => {
                    el.classList.remove('selected');
                });
                
                // Add selected class to clicked option
                event.target.closest('.answer-option').classList.add('selected');
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < currentQuizSession.questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }
        
        function submitQuiz() {
            if (quizTimer) {
                clearInterval(quizTimer);
            }
            
            // Calculate score
            let correctAnswers = 0;
            let totalPoints = 0;
            
            currentQuizSession.questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                let isCorrect = false;
                
                switch(question.type) {
                    case 'multiple':
                        isCorrect = userAnswer === question.correct;
                        break;
                    case 'true-false':
                        isCorrect = userAnswer === question.correct;
                        break;
                    case 'fill-blank':
                        isCorrect = userAnswer && userAnswer.toLowerCase().trim() === question.correct.toLowerCase().trim();
                        break;
                }
                
                if (isCorrect) {
                    correctAnswers++;
                    currentQuizSession.score += question.points;
                }
                totalPoints += question.points;
            });
            
            const percentage = Math.round((currentQuizSession.score / totalPoints) * 100);
            const timeTaken = Math.round((Date.now() - currentQuizSession.startTime) / 1000);
            const passed = percentage >= currentQuizSession.quiz.passingScore;
            
            // Hide interface, show results
            document.getElementById('quizInterface').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            // Update results display
            document.getElementById('resultIcon').textContent = passed ? 'üéâ' : 'üòî';
            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('correctAnswers').textContent = `${correctAnswers}/${currentQuizSession.questions.length}`;
            document.getElementById('timeTaken').textContent = formatTime(timeTaken);
            document.getElementById('passingMessage').textContent = passed ? 
                'üéä Congratulations! You passed!' : 
                `üòî You need ${currentQuizSession.quiz.passingScore}% to pass. Try again!`;
            
            // Save result to stats
            saveQuizResult({
                quizId: currentQuizSession.quiz.id,
                quizTitle: currentQuizSession.quiz.title,
                score: percentage,
                correctAnswers: correctAnswers,
                totalQuestions: currentQuizSession.questions.length,
                timeTaken: timeTaken,
                passed: passed,
                date: new Date().toISOString()
            });
            
            // Show celebration animation if passed
            if (passed) {
                createConfetti();
            }
            
            showNotification(passed ? 'üéâ Quiz completed successfully!' : 'üìù Quiz completed. Keep practicing!', passed ? 'success' : 'info');
        }
        
        function reviewAnswers() {
            showNotification('üìù Review mode coming soon!', 'info');
        }
        
        function retakeQuiz() {
            if (currentQuizSession.quiz.allowRetake) {
                startQuiz(currentQuizSession.quiz.id);
            } else {
                showNotification('‚ö†Ô∏è Retakes are not allowed for this quiz!', 'warning');
            }
        }
        
        function backToSelection() {
            resetQuizInterface();
        }
        
        function resetQuizInterface() {
            document.getElementById('quizSelection').classList.remove('hidden');
            document.getElementById('quizInterface').classList.add('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            
            if (quizTimer) {
                clearInterval(quizTimer);
                quizTimer = null;
            }
            
            currentQuizSession = null;
            userAnswers = [];
            currentQuestionIndex = 0;
        }
        
        // Statistics
        function saveQuizResult(result) {
            let results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            results.push(result);
            localStorage.setItem('quizResults', JSON.stringify(results));
        }
        
        function updateStats() {
            const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
            const quizzes = JSON.parse(localStorage.getItem('quizLibrary') || '[]');
            
            // Update stat cards
            document.getElementById('totalQuizzesCreated').textContent = quizzes.length;
            document.getElementById('totalQuizzesTaken').textContent = results.length;
            
            if (results.length > 0) {
                const averageScore = Math.round(results.reduce((sum, r) => sum + r.score, 0) / results.length);
                const bestScore = Math.max(...results.map(r => r.score));
                
                document.getElementById('averageScore').textContent = averageScore + '%';
                document.getElementById('bestScore').textContent = bestScore + '%';
            } else {
                document.getElementById('averageScore').textContent = '0%';
                document.getElementById('bestScore').textContent = '0%';
            }
            
            // Update recent activity
            updateRecentActivity(results);
            
            // Update leaderboard
            updateLeaderboard(results);
        }
        
        function updateRecentActivity(results) {
            const container = document.getElementById('recentActivity');
            const recent = results.slice(-10).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-3xl mb-2">üìä</div>
                        <div>No activity yet</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(result => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium">${result.quizTitle}</div>
                        <div class="text-sm text-gray-600">${new Date(result.date).toLocaleDateString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${result.passed ? 'text-green-600' : 'text-red-600'}">${result.score}%</div>
                        <div class="text-xs text-gray-500">${result.correctAnswers}/${result.totalQuestions}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateLeaderboard(results) {
            const container = document.getElementById('leaderboard');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-3xl mb-2">üèÜ</div>
                        <div>No scores yet</div>
                    </div>
                `;
                return;
            }
            
            // Group by quiz and get best scores
            const bestScores = {};
            results.forEach(result => {
                if (!bestScores[result.quizId] || bestScores[result.quizId].score < result.score) {
                    bestScores[result.quizId] = result;
                }
            });
            
            const topScores = Object.values(bestScores)
                .sort((a, b) => b.score - a.score)
                .slice(0, 10);
            
            container.innerHTML = topScores.map((result, index) => `
                <div class="leaderboard-item flex items-center justify-between p-3 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-8 h-8 flex items-center justify-center mr-3">
                            ${index === 0 ? '<span class="medal-gold text-xl">ü•á</span>' :
                              index === 1 ? '<span class="medal-silver text-xl">ü•à</span>' :
                              index === 2 ? '<span class="medal-bronze text-xl">ü•â</span>' :
                              `<span class="text-gray-500 font-bold">${index + 1}</span>`}
                        </div>
                        <div>
                            <div class="font-medium">${result.quizTitle}</div>
                            <div class="text-sm text-gray-600">${new Date(result.date).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-lg">${result.score}%</div>
                        <div class="text-xs text-gray-500">${formatTime(result.timeTaken)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Utility functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        top: -10px;
                        left: ${Math.random() * 100}vw;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        z-index: 1000;
                        pointer-events: none;
                    `;
                    confetti.classList.add('confetti');
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 100);
            }
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fade-in p-4 rounded-lg text-white font-medium ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-yellow-600' :
                'bg-blue-600'
            }`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9715b6d782e558ac',t:'MTc1NTU2NTIyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
