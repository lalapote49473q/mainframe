<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Stock Market Dashboard</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%); }
        .stock-card {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .stock-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .price-up { color: #10b981; }
        .price-down { color: #ef4444; }
        .price-neutral { color: #6b7280; }
        .market-cap-large { border-left: 4px solid #3b82f6; }
        .market-cap-mid { border-left: 4px solid #f59e0b; }
        .market-cap-small { border-left: 4px solid #10b981; }
        .market-cap-micro { border-left: 4px solid #8b5cf6; }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .chart-mini {
            width: 60px;
            height: 30px;
        }
        .sector-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Back to Main Button -->
<div class="absolute top-4 left-4">
    <a href="main.html" 
       class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
        ‚¨ÖÔ∏è Back to Main
    </a>
</div>
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">üìà Global Stock Market</h1>
            <p class="text-xl text-white opacity-90">Real-time tracking of 500+ stocks across all market caps</p>
            <div class="flex justify-center space-x-4 mt-4">
                <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2">
                    <span class="text-white font-semibold">Market Status: </span>
                    <span id="marketStatus" class="text-green-400 font-bold">OPEN</span>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg px-4 py-2">
                    <span class="text-white font-semibold">Last Update: </span>
                    <span id="lastUpdate" class="text-blue-300"></span>
                </div>
            </div>
        </div>

        <!-- Market Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white bg-opacity-10 rounded-xl p-6 text-white">
                <h3 class="text-lg font-semibold mb-2">üìä S&P 500</h3>
                <div class="text-2xl font-bold" id="sp500Price">4,185.47</div>
                <div class="text-sm" id="sp500Change">+12.34 (+0.30%)</div>
            </div>
            <div class="bg-white bg-opacity-10 rounded-xl p-6 text-white">
                <h3 class="text-lg font-semibold mb-2">üèõÔ∏è Dow Jones</h3>
                <div class="text-2xl font-bold" id="dowPrice">33,745.69</div>
                <div class="text-sm" id="dowChange">+89.12 (+0.26%)</div>
            </div>
            <div class="bg-white bg-opacity-10 rounded-xl p-6 text-white">
                <h3 class="text-lg font-semibold mb-2">üíª NASDAQ</h3>
                <div class="text-2xl font-bold" id="nasdaqPrice">12,850.22</div>
                <div class="text-sm" id="nasdaqChange">+45.67 (+0.36%)</div>
            </div>
            <div class="bg-white bg-opacity-10 rounded-xl p-6 text-white">
                <h3 class="text-lg font-semibold mb-2">üåç Russell 2000</h3>
                <div class="text-2xl font-bold" id="russellPrice">1,987.45</div>
                <div class="text-sm" id="russellChange">-5.23 (-0.26%)</div>
            </div>
        </div>

        <!-- Filters and Search -->
        <div class="bg-white bg-opacity-10 rounded-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div>
                    <input type="text" id="searchInput" placeholder="Search stocks..." 
                           class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30">
                </div>
                <div>
                    <select id="sectorFilter" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30">
                        <option value="">All Sectors</option>
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Financial">Financial</option>
                        <option value="Consumer">Consumer</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Energy">Energy</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Materials">Materials</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Telecom">Telecom</option>
                    </select>
                </div>
                <div>
                    <select id="capFilter" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30">
                        <option value="">All Market Caps</option>
                        <option value="Large">Large Cap (>$10B)</option>
                        <option value="Mid">Mid Cap ($2B-$10B)</option>
                        <option value="Small">Small Cap ($300M-$2B)</option>
                        <option value="Micro">Micro Cap (<$300M)</option>
                    </select>
                </div>
                <div>
                    <select id="sortBy" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30">
                        <option value="symbol">Symbol A-Z</option>
                        <option value="price">Price High-Low</option>
                        <option value="change">% Change</option>
                        <option value="volume">Volume</option>
                        <option value="marketCap">Market Cap</option>
                    </select>
                </div>
                <div>
                    <button onclick="refreshData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-semibold transition-colors">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Stock Grid -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-white">Stock Listings</h2>
                <div class="text-white">
                    <span id="stockCount">500</span> stocks found
                </div>
            </div>
            
            <div id="stockGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-h-screen overflow-y-auto scrollbar-hide">
                <!-- Stocks will be populated here -->
            </div>
        </div>

        <!-- Market Cap Legend -->
        <div class="bg-white bg-opacity-10 rounded-xl p-6 mt-8">
            <h3 class="text-xl font-bold text-white mb-4">Market Cap Legend</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-blue-500 rounded mr-2"></div>
                    <span class="text-white">Large Cap (>$10B)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-amber-500 rounded mr-2"></div>
                    <span class="text-white">Mid Cap ($2B-$10B)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-green-500 rounded mr-2"></div>
                    <span class="text-white">Small Cap ($300M-$2B)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-purple-500 rounded mr-2"></div>
                    <span class="text-white">Micro Cap (<$300M)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allStocks = [];
        let filteredStocks = [];

        // Comprehensive stock data with real and simulated companies
        const stockData = [
            // Large Cap Stocks
            { symbol: 'AAPL', name: 'Apple Inc.', price: 175.43, change: 2.15, changePercent: 1.24, volume: 45234567, marketCap: 2800000, sector: 'Technology', cap: 'Large' },
            { symbol: 'MSFT', name: 'Microsoft Corporation', price: 338.11, change: -1.23, changePercent: -0.36, volume: 23456789, marketCap: 2500000, sector: 'Technology', cap: 'Large' },
            { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 125.37, change: 0.89, changePercent: 0.72, volume: 34567890, marketCap: 1600000, sector: 'Technology', cap: 'Large' },
            { symbol: 'AMZN', name: 'Amazon.com Inc.', price: 127.74, change: -2.45, changePercent: -1.88, volume: 56789012, marketCap: 1300000, sector: 'Consumer', cap: 'Large' },
            { symbol: 'TSLA', name: 'Tesla Inc.', price: 248.50, change: 12.34, changePercent: 5.22, volume: 78901234, marketCap: 790000, sector: 'Consumer', cap: 'Large' },
            { symbol: 'META', name: 'Meta Platforms Inc.', price: 296.73, change: 4.56, changePercent: 1.56, volume: 23456789, marketCap: 750000, sector: 'Technology', cap: 'Large' },
            { symbol: 'NVDA', name: 'NVIDIA Corporation', price: 421.13, change: 8.92, changePercent: 2.16, volume: 45678901, marketCap: 1040000, sector: 'Technology', cap: 'Large' },
            { symbol: 'BRK.A', name: 'Berkshire Hathaway', price: 515000, change: 2500, changePercent: 0.49, volume: 1234, marketCap: 740000, sector: 'Financial', cap: 'Large' },
            { symbol: 'JPM', name: 'JPMorgan Chase & Co.', price: 145.67, change: -0.78, changePercent: -0.53, volume: 12345678, marketCap: 430000, sector: 'Financial', cap: 'Large' },
            { symbol: 'JNJ', name: 'Johnson & Johnson', price: 162.34, change: 1.23, changePercent: 0.76, volume: 8765432, marketCap: 430000, sector: 'Healthcare', cap: 'Large' },
            { symbol: 'V', name: 'Visa Inc.', price: 234.56, change: 3.45, changePercent: 1.49, volume: 6543210, marketCap: 480000, sector: 'Financial', cap: 'Large' },
            { symbol: 'PG', name: 'Procter & Gamble', price: 151.23, change: 0.67, changePercent: 0.44, volume: 5432109, marketCap: 360000, sector: 'Consumer', cap: 'Large' },
            { symbol: 'UNH', name: 'UnitedHealth Group', price: 524.78, change: 7.89, changePercent: 1.53, volume: 3210987, marketCap: 490000, sector: 'Healthcare', cap: 'Large' },
            { symbol: 'HD', name: 'Home Depot Inc.', price: 312.45, change: -2.34, changePercent: -0.74, volume: 4321098, marketCap: 320000, sector: 'Consumer', cap: 'Large' },
            { symbol: 'MA', name: 'Mastercard Inc.', price: 378.90, change: 5.67, changePercent: 1.52, volume: 2109876, marketCap: 360000, sector: 'Financial', cap: 'Large' },

            // Mid Cap Stocks
            { symbol: 'ROKU', name: 'Roku Inc.', price: 65.43, change: 2.34, changePercent: 3.71, volume: 8765432, marketCap: 7200, sector: 'Technology', cap: 'Mid' },
            { symbol: 'SNAP', name: 'Snap Inc.', price: 11.23, change: -0.45, changePercent: -3.86, volume: 45678901, marketCap: 18500, sector: 'Technology', cap: 'Mid' },
            { symbol: 'TWTR', name: 'Twitter Inc.', price: 54.20, change: 1.78, changePercent: 3.40, volume: 23456789, marketCap: 42000, sector: 'Technology', cap: 'Mid' },
            { symbol: 'SQ', name: 'Block Inc.', price: 78.90, change: -1.23, changePercent: -1.54, volume: 12345678, marketCap: 45600, sector: 'Financial', cap: 'Mid' },
            { symbol: 'SPOT', name: 'Spotify Technology', price: 156.78, change: 4.56, changePercent: 3.00, volume: 6789012, marketCap: 30200, sector: 'Technology', cap: 'Mid' },
            { symbol: 'ZM', name: 'Zoom Video Communications', price: 89.45, change: -2.34, changePercent: -2.55, volume: 8901234, marketCap: 26800, sector: 'Technology', cap: 'Mid' },
            { symbol: 'DOCU', name: 'DocuSign Inc.', price: 67.89, change: 1.45, changePercent: 2.18, volume: 5678901, marketCap: 13400, sector: 'Technology', cap: 'Mid' },
            { symbol: 'CRWD', name: 'CrowdStrike Holdings', price: 178.23, change: 6.78, changePercent: 3.95, volume: 3456789, marketCap: 41200, sector: 'Technology', cap: 'Mid' },
            { symbol: 'OKTA', name: 'Okta Inc.', price: 95.67, change: -1.89, changePercent: -1.94, volume: 4567890, marketCap: 15800, sector: 'Technology', cap: 'Mid' },
            { symbol: 'DDOG', name: 'Datadog Inc.', price: 112.34, change: 3.45, changePercent: 3.17, volume: 2345678, marketCap: 35600, sector: 'Technology', cap: 'Mid' },

            // Small Cap Stocks
            { symbol: 'PLTR', name: 'Palantir Technologies', price: 16.78, change: 0.89, changePercent: 5.60, volume: 34567890, marketCap: 35000, sector: 'Technology', cap: 'Small' },
            { symbol: 'WISH', name: 'ContextLogic Inc.', price: 2.45, change: -0.12, changePercent: -4.67, volume: 23456789, marketCap: 1600, sector: 'Consumer', cap: 'Small' },
            { symbol: 'CLOV', name: 'Clover Health Investments', price: 3.67, change: 0.23, changePercent: 6.69, volume: 12345678, marketCap: 1800, sector: 'Healthcare', cap: 'Small' },
            { symbol: 'BB', name: 'BlackBerry Limited', price: 5.89, change: -0.34, changePercent: -5.46, volume: 8765432, marketCap: 3400, sector: 'Technology', cap: 'Small' },
            { symbol: 'NOK', name: 'Nokia Corporation', price: 4.23, change: 0.12, changePercent: 2.92, volume: 45678901, marketCap: 24000, sector: 'Technology', cap: 'Small' },
            { symbol: 'SNDL', name: 'Sundial Growers Inc.', price: 0.78, change: -0.05, changePercent: -6.02, volume: 67890123, marketCap: 450, sector: 'Healthcare', cap: 'Small' },
            { symbol: 'TLRY', name: 'Tilray Brands Inc.', price: 3.45, change: 0.18, changePercent: 5.50, volume: 23456789, marketCap: 1800, sector: 'Healthcare', cap: 'Small' },
            { symbol: 'SPCE', name: 'Virgin Galactic Holdings', price: 8.90, change: -0.67, changePercent: -7.01, volume: 12345678, marketCap: 2300, sector: 'Industrial', cap: 'Small' },
            { symbol: 'RIDE', name: 'Lordstown Motors Corp.', price: 1.23, change: 0.08, changePercent: 6.96, volume: 8765432, marketCap: 280, sector: 'Consumer', cap: 'Small' },
            { symbol: 'WKHS', name: 'Workhorse Group Inc.', price: 2.67, change: -0.15, changePercent: -5.32, volume: 6543210, marketCap: 420, sector: 'Industrial', cap: 'Small' },

            // Micro Cap Stocks
            { symbol: 'HMHC', name: 'Houghton Mifflin Harcourt', price: 1.45, change: 0.12, changePercent: 9.02, volume: 2345678, marketCap: 180, sector: 'Consumer', cap: 'Micro' },
            { symbol: 'EXPR', name: 'Express Inc.', price: 0.89, change: -0.08, changePercent: -8.25, volume: 5432109, marketCap: 60, sector: 'Consumer', cap: 'Micro' },
            { symbol: 'GNUS', name: 'Genius Brands International', price: 0.67, change: 0.05, changePercent: 8.06, volume: 8765432, marketCap: 210, sector: 'Technology', cap: 'Micro' },
            { symbol: 'TOPS', name: 'TOP Ships Inc.', price: 0.34, change: -0.03, changePercent: -8.11, volume: 12345678, marketCap: 15, sector: 'Industrial', cap: 'Micro' },
            { symbol: 'SHIP', name: 'Seanergy Maritime Holdings', price: 0.78, change: 0.06, changePercent: 8.33, volume: 3456789, marketCap: 85, sector: 'Industrial', cap: 'Micro' },
            { symbol: 'GLBS', name: 'Globus Maritime Limited', price: 0.45, change: -0.04, changePercent: -8.16, volume: 6789012, marketCap: 25, sector: 'Industrial', cap: 'Micro' },
            { symbol: 'DRYS', name: 'DryShips Inc.', price: 0.23, change: 0.02, changePercent: 9.52, volume: 9876543, marketCap: 12, sector: 'Industrial', cap: 'Micro' },
            { symbol: 'EARS', name: 'Auris Medical Holding', price: 1.12, change: -0.09, changePercent: -7.44, volume: 1234567, marketCap: 45, sector: 'Healthcare', cap: 'Micro' },
            { symbol: 'JAGX', name: 'Jaguar Health Inc.', price: 0.56, change: 0.04, changePercent: 7.69, volume: 4567890, marketCap: 35, sector: 'Healthcare', cap: 'Micro' },
            { symbol: 'INPX', name: 'Inpixon', price: 0.89, change: -0.07, changePercent: -7.29, volume: 7890123, marketCap: 78, sector: 'Technology', cap: 'Micro' }
        ];

        // Generate additional stocks to reach 500+
        function generateAdditionalStocks() {
            const sectors = ['Technology', 'Healthcare', 'Financial', 'Consumer', 'Industrial', 'Energy', 'Utilities', 'Materials', 'Real Estate', 'Telecom'];
            const caps = ['Large', 'Mid', 'Small', 'Micro'];
            const capRanges = {
                'Large': { min: 500000, max: 3000000, priceMin: 50, priceMax: 500 },
                'Mid': { min: 2000, max: 100000, priceMin: 10, priceMax: 200 },
                'Small': { min: 300, max: 2000, priceMin: 1, priceMax: 50 },
                'Micro': { min: 10, max: 300, priceMin: 0.1, priceMax: 10 }
            };

            const companyNames = [
                'Global Tech Solutions', 'Advanced Healthcare Systems', 'Premier Financial Group', 'Consumer Dynamics Corp',
                'Industrial Innovations Ltd', 'Energy Future Holdings', 'Utility Networks Inc', 'Materials Science Corp',
                'Real Estate Ventures', 'Telecom Solutions Group', 'Digital Transformation Co', 'BioMed Research Inc',
                'Financial Technology Partners', 'Consumer Retail Chain', 'Manufacturing Excellence Corp', 'Renewable Energy Systems',
                'Infrastructure Development', 'Chemical Processing Ltd', 'Property Management Group', 'Communications Network Inc',
                'Software Development Corp', 'Medical Devices International', 'Investment Banking Group', 'E-commerce Platform Inc',
                'Aerospace Manufacturing', 'Solar Power Solutions', 'Water Treatment Systems', 'Specialty Chemicals Corp',
                'Commercial Real Estate Trust', 'Wireless Technology Inc', 'Cloud Computing Services', 'Pharmaceutical Research Ltd',
                'Credit Services Corporation', 'Retail Technology Solutions', 'Heavy Machinery Corp', 'Wind Energy Development',
                'Electric Utility Company', 'Mining Operations Ltd', 'Hospitality Management Group', 'Satellite Communications Inc'
            ];

            for (let i = stockData.length; i < 500; i++) {
                const cap = caps[Math.floor(Math.random() * caps.length)];
                const sector = sectors[Math.floor(Math.random() * sectors.length)];
                const capRange = capRanges[cap];
                
                const symbol = generateRandomSymbol();
                const name = companyNames[Math.floor(Math.random() * companyNames.length)] + ' ' + (Math.floor(Math.random() * 1000) + 1);
                const price = parseFloat((Math.random() * (capRange.priceMax - capRange.priceMin) + capRange.priceMin).toFixed(2));
                const changePercent = parseFloat(((Math.random() - 0.5) * 20).toFixed(2));
                const change = parseFloat((price * changePercent / 100).toFixed(2));
                const volume = Math.floor(Math.random() * 50000000) + 100000;
                const marketCap = Math.floor(Math.random() * (capRange.max - capRange.min) + capRange.min);

                stockData.push({
                    symbol,
                    name,
                    price,
                    change,
                    changePercent,
                    volume,
                    marketCap,
                    sector,
                    cap
                });
            }
        }

        function generateRandomSymbol() {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let symbol = '';
            const length = Math.random() > 0.7 ? 4 : 3; // 30% chance of 4-letter symbol
            for (let i = 0; i < length; i++) {
                symbol += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            return symbol;
        }

        function initializeStocks() {
            generateAdditionalStocks();
            allStocks = [...stockData];
            filteredStocks = [...allStocks];
            renderStocks();
            updateMarketOverview();
            updateLastUpdateTime();
        }

        function renderStocks() {
            const grid = document.getElementById('stockGrid');
            const stockCount = document.getElementById('stockCount');
            
            stockCount.textContent = filteredStocks.length;
            
            grid.innerHTML = filteredStocks.map(stock => {
                const priceClass = stock.changePercent > 0 ? 'price-up' : stock.changePercent < 0 ? 'price-down' : 'price-neutral';
                const capClass = `market-cap-${stock.cap.toLowerCase()}`;
                const arrow = stock.changePercent > 0 ? '‚ÜóÔ∏è' : stock.changePercent < 0 ? '‚ÜòÔ∏è' : '‚û°Ô∏è';
                
                return `
                    <div class="stock-card bg-white bg-opacity-10 rounded-xl p-4 ${capClass}" onclick="showStockDetails('${stock.symbol}')">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-white font-bold text-lg">${stock.symbol}</h3>
                                <p class="text-gray-300 text-sm truncate">${stock.name}</p>
                            </div>
                            <span class="sector-badge bg-gray-600 text-white rounded-full">${stock.sector}</span>
                        </div>
                        
                        <div class="mb-3">
                            <div class="text-white text-xl font-bold">$${stock.price.toLocaleString()}</div>
                            <div class="${priceClass} text-sm font-semibold">
                                ${arrow} ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)} (${stock.changePercent >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%)
                            </div>
                        </div>
                        
                        <div class="text-gray-300 text-xs space-y-1">
                            <div>Volume: ${stock.volume.toLocaleString()}</div>
                            <div>Market Cap: $${formatMarketCap(stock.marketCap)}</div>
                            <div class="flex items-center">
                                <span class="w-2 h-2 rounded-full mr-2 ${getCapColor(stock.cap)}"></span>
                                ${stock.cap} Cap
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-white border-opacity-20">
                            <canvas class="chart-mini w-full" data-symbol="${stock.symbol}"></canvas>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Draw mini charts
            setTimeout(() => {
                filteredStocks.forEach(stock => {
                    drawMiniChart(stock.symbol);
                });
            }, 100);
        }

        function drawMiniChart(symbol) {
            const canvas = document.querySelector(`canvas[data-symbol="${symbol}"]`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.offsetWidth;
            const height = 30;
            canvas.width = width;
            canvas.height = height;
            
            // Generate random historical data
            const points = 20;
            const data = [];
            let basePrice = filteredStocks.find(s => s.symbol === symbol)?.price || 100;
            
            for (let i = 0; i < points; i++) {
                basePrice += (Math.random() - 0.5) * basePrice * 0.05;
                data.push(basePrice);
            }
            
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            
            ctx.strokeStyle = '#60a5fa';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            
            data.forEach((price, i) => {
                const x = (i / (points - 1)) * width;
                const y = height - ((price - min) / range) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        function getCapColor(cap) {
            const colors = {
                'Large': 'bg-blue-500',
                'Mid': 'bg-amber-500',
                'Small': 'bg-green-500',
                'Micro': 'bg-purple-500'
            };
            return colors[cap] || 'bg-gray-500';
        }

        function formatMarketCap(marketCap) {
            if (marketCap >= 1000000) {
                return (marketCap / 1000000).toFixed(1) + 'T';
            } else if (marketCap >= 1000) {
                return (marketCap / 1000).toFixed(1) + 'B';
            } else {
                return marketCap.toFixed(0) + 'M';
            }
        }

        function showStockDetails(symbol) {
            const stock = allStocks.find(s => s.symbol === symbol);
            if (!stock) return;
            
            alert(`
Stock Details: ${stock.symbol}
Company: ${stock.name}
Price: $${stock.price.toLocaleString()}
Change: ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)} (${stock.changePercent >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%)
Volume: ${stock.volume.toLocaleString()}
Market Cap: $${formatMarketCap(stock.marketCap)}
Sector: ${stock.sector}
Market Cap Category: ${stock.cap} Cap
            `);
        }

        function updateMarketOverview() {
            // Simulate market index updates
            const indices = [
                { id: 'sp500', price: 4185.47, change: 12.34 },
                { id: 'dow', price: 33745.69, change: 89.12 },
                { id: 'nasdaq', price: 12850.22, change: 45.67 },
                { id: 'russell', price: 1987.45, change: -5.23 }
            ];
            
            indices.forEach(index => {
                const priceEl = document.getElementById(`${index.id}Price`);
                const changeEl = document.getElementById(`${index.id}Change`);
                
                // Add some random variation
                const newPrice = index.price + (Math.random() - 0.5) * 10;
                const newChange = index.change + (Math.random() - 0.5) * 5;
                const changePercent = (newChange / newPrice) * 100;
                
                priceEl.textContent = newPrice.toLocaleString('en-US', { minimumFractionDigits: 2 });
                changeEl.textContent = `${newChange >= 0 ? '+' : ''}${newChange.toFixed(2)} (${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%)`;
                changeEl.className = newChange >= 0 ? 'text-sm price-up' : 'text-sm price-down';
            });
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sectorFilter = document.getElementById('sectorFilter').value;
            const capFilter = document.getElementById('capFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            filteredStocks = allStocks.filter(stock => {
                const matchesSearch = stock.symbol.toLowerCase().includes(searchTerm) || 
                                    stock.name.toLowerCase().includes(searchTerm);
                const matchesSector = !sectorFilter || stock.sector === sectorFilter;
                const matchesCap = !capFilter || stock.cap === capFilter;
                
                return matchesSearch && matchesSector && matchesCap;
            });
            
            // Sort stocks
            filteredStocks.sort((a, b) => {
                switch (sortBy) {
                    case 'symbol':
                        return a.symbol.localeCompare(b.symbol);
                    case 'price':
                        return b.price - a.price;
                    case 'change':
                        return b.changePercent - a.changePercent;
                    case 'volume':
                        return b.volume - a.volume;
                    case 'marketCap':
                        return b.marketCap - a.marketCap;
                    default:
                        return 0;
                }
            });
            
            renderStocks();
        }

        function refreshData() {
            // Simulate real-time price updates
            allStocks.forEach(stock => {
                const volatility = stock.cap === 'Micro' ? 0.1 : stock.cap === 'Small' ? 0.05 : 0.02;
                const priceChange = (Math.random() - 0.5) * stock.price * volatility;
                stock.price = Math.max(0.01, stock.price + priceChange);
                stock.change = priceChange;
                stock.changePercent = (priceChange / (stock.price - priceChange)) * 100;
                stock.volume = Math.floor(stock.volume * (0.8 + Math.random() * 0.4));
            });
            
            applyFilters();
            updateMarketOverview();
            updateLastUpdateTime();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('sectorFilter').addEventListener('change', applyFilters);
        document.getElementById('capFilter').addEventListener('change', applyFilters);
        document.getElementById('sortBy').addEventListener('change', applyFilters);

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);

        // Initialize the application
        initializeStocks();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9703d90ce7c1ee17',t:'MTc1NTM3Nzg4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
