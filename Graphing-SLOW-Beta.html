<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Graphing Calculator</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 2px solid #e9ecef;
            overflow-y: auto;
        }
        
        .graph-container {
            flex: 1;
            position: relative;
            background: #fff;
        }
        

        
        .function-input {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .function-input.active {
            border-color: #3498db;
        }
        
        .function-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .color-picker {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .function-label {
            font-weight: 600;
            margin-right: 10px;
        }
        
        .delete-btn {
            margin-left: auto;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .function-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .add-function {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .control-group label {
            width: 80px;
            font-weight: 600;
        }
        
        .control-group input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-left: 10px;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 600px;
            overflow: hidden;
            background: #ffffff;
        }
        
        canvas {
            display: block;
            cursor: grab;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            background: #ffffff;
        }
        
        canvas:active {
            cursor: grabbing;
        }
        
        .canvas-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .help-text {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .help-text h4 {
            margin-bottom: 10px;
            color: #856404;
        }
        
        .help-text ul {
            margin-left: 20px;
        }
        
        .help-text li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ 2D Graphing Calculator</h1>
            <p>Plot multiple 2D functions with interactive zoom and pan</p>
        </div>
        
        <div class="main-content">
            <div class="sidebar">

                
                <div id="functions-container">
                    <div class="function-input active" data-id="0">
                        <div class="function-header">
                            <input type="color" class="color-picker" value="#e74c3c" onchange="updateFunction(0)">
                            <span class="function-label">f(x) =</span>
                            <button class="delete-btn" onclick="deleteFunction(0)" style="display: none;">Delete</button>
                        </div>
                        <input type="text" placeholder="x^2" value="x^2" oninput="updateFunction(0)">
                    </div>
                </div>
                
                <button class="add-function" onclick="addFunction()">+ Add Function</button>
                
                <div class="controls">
                    <h3>View Controls</h3>
                    <div class="control-group">
                        <label>X Range:</label>
                        <input type="number" id="xMin" value="-10" onchange="updateView()">
                        <input type="number" id="xMax" value="10" onchange="updateView()">
                    </div>
                    <div class="control-group">
                        <label>Y Range:</label>
                        <input type="number" id="yMin" value="-10" onchange="updateView()">
                        <input type="number" id="yMax" value="10" onchange="updateView()">
                    </div>

                </div>
                
                <div class="help-text">
                    <h4>üìù Function Examples:</h4>
                    <ul>
                        <li>x^2, sin(x), cos(x), tan(x)</li>
                        <li>log(x), sqrt(x), abs(x)</li>
                        <li>x^3 - 2*x, 1/x, x*sin(x)</li>
                        <li>exp(x), x^2 + 3*x - 5</li>
                    </ul>
                    <p><strong>Controls:</strong> Drag to pan, scroll to zoom</p>
                </div>
            </div>
            
            <div class="graph-container">
                <div class="canvas-container">
                    <canvas id="graphCanvas"></canvas>
                    <div class="canvas-info" id="canvasInfo">
                        Mode: 2D | Functions: 1 | Zoom: 1.0x
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let functions = [{
            id: 0,
            expression: 'x^2',
            color: '#e74c3c',
            active: true
        }];
        let nextId = 1;
        
        // Canvas and rendering variables
        let canvas, ctx;
        let viewBox = { xMin: -10, xMax: 10, yMin: -10, yMax: 10 };
        let zoom = 1;
        let panOffset = { x: 0, y: 0 };
        let isDragging = false;
        let lastMousePos = { x: 0, y: 0 };
        
        function initCanvas() {
            canvas = document.getElementById('graphCanvas');
            ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                drawGraph();
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrag);
            canvas.addEventListener('mousemove', drag);
            canvas.addEventListener('mouseup', endDrag);
            canvas.addEventListener('wheel', handleZoom);
            
            drawGraph();
        }
        
        function startDrag(e) {
            isDragging = true;
            lastMousePos = { x: e.clientX, y: e.clientY };
        }
        
        function drag(e) {
            if (!isDragging) return;
            
            const dx = e.clientX - lastMousePos.x;
            const dy = e.clientY - lastMousePos.y;
            
            const xRange = viewBox.xMax - viewBox.xMin;
            const yRange = viewBox.yMax - viewBox.yMin;
            
            const deltaX = (dx / canvas.width) * xRange;
            const deltaY = (dy / canvas.height) * yRange;
            
            viewBox.xMin -= deltaX;
            viewBox.xMax -= deltaX;
            viewBox.yMin += deltaY;
            viewBox.yMax += deltaY;
            
            updateViewInputs();
            
            lastMousePos = { x: e.clientX, y: e.clientY };
            drawGraph();
        }
        
        function endDrag() {
            isDragging = false;
        }
        
        function handleZoom(e) {
            e.preventDefault();
            const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;
            
            const centerX = (viewBox.xMin + viewBox.xMax) / 2;
            const centerY = (viewBox.yMin + viewBox.yMax) / 2;
            
            const xRange = (viewBox.xMax - viewBox.xMin) * zoomFactor;
            const yRange = (viewBox.yMax - viewBox.yMin) * zoomFactor;
            
            viewBox.xMin = centerX - xRange / 2;
            viewBox.xMax = centerX + xRange / 2;
            viewBox.yMin = centerY - yRange / 2;
            viewBox.yMax = centerY + yRange / 2;
            
            updateViewInputs();
            zoom *= (1 / zoomFactor);
            drawGraph();
        }
        

        
        function addFunction() {
            const container = document.getElementById('functions-container');
            const colors = ['#3498db', '#27ae60', '#f39c12', '#9b59b6', '#e67e22', '#1abc9c'];
            const color = colors[functions.length % colors.length];
            
            const functionDiv = document.createElement('div');
            functionDiv.className = 'function-input';
            functionDiv.setAttribute('data-id', nextId);
            
            functionDiv.innerHTML = `
                <div class="function-header">
                    <input type="color" class="color-picker" value="${color}" onchange="updateFunction(${nextId})">
                    <span class="function-label">f(x) =</span>
                    <button class="delete-btn" onclick="deleteFunction(${nextId})">Delete</button>
                </div>
                <input type="text" placeholder="sin(x)" oninput="updateFunction(${nextId})">
            `;
            
            container.appendChild(functionDiv);
            
            functions.push({
                id: nextId,
                expression: '',
                color: color,
                active: true
            });
            
            nextId++;
            updateDeleteButtons();
            drawGraph();
        }
        
        function deleteFunction(id) {
            functions = functions.filter(f => f.id !== id);
            document.querySelector(`[data-id="${id}"]`).remove();
            updateDeleteButtons();
            drawGraph();
        }
        
        function updateDeleteButtons() {
            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(btn => {
                btn.style.display = functions.length > 1 ? 'inline-block' : 'none';
            });
        }
        
        function updateFunction(id) {
            const functionDiv = document.querySelector(`[data-id="${id}"]`);
            const input = functionDiv.querySelector('input[type="text"]');
            const colorPicker = functionDiv.querySelector('.color-picker');
            
            const func = functions.find(f => f.id === id);
            if (func) {
                func.expression = input.value;
                func.color = colorPicker.value;
            }
            
            drawGraph();
        }
        
        function updateView() {
            viewBox.xMin = parseFloat(document.getElementById('xMin').value);
            viewBox.xMax = parseFloat(document.getElementById('xMax').value);
            viewBox.yMin = parseFloat(document.getElementById('yMin').value);
            viewBox.yMax = parseFloat(document.getElementById('yMax').value);
            
            drawGraph();
        }
        
        function updateViewInputs() {
            document.getElementById('xMin').value = viewBox.xMin.toFixed(2);
            document.getElementById('xMax').value = viewBox.xMax.toFixed(2);
            document.getElementById('yMin').value = viewBox.yMin.toFixed(2);
            document.getElementById('yMax').value = viewBox.yMax.toFixed(2);
        }
        
        function evaluateExpression(expr, x, y = 0) {
            try {
                if (!expr || expr.trim() === '') return NaN;
                
                // Simple expression evaluator without eval()
                return evaluateMathExpression(expr, x, y);
            } catch (e) {
                console.log('Error evaluating:', expr, 'at x =', x, ':', e.message);
                return NaN;
            }
        }
        
        function evaluateMathExpression(expr, x, y = 0) {
            // Replace variables first
            let processed = expr.toLowerCase()
                .replace(/\bx\b/g, x.toString())
                .replace(/\by\b/g, y.toString());
            
            // Handle implicit multiplication
            processed = processed.replace(/(\d)([a-zA-Z])/g, '$1*$2');
            processed = processed.replace(/([a-zA-Z])(\d)/g, '$1*$2');
            processed = processed.replace(/(\))(\()/g, '$1*$2');
            
            // Replace constants
            processed = processed.replace(/\bpi\b/g, Math.PI.toString());
            processed = processed.replace(/\be\b/g, Math.E.toString());
            
            return parseExpression(processed);
        }
        
        function parseExpression(expr) {
            // Remove spaces
            expr = expr.replace(/\s/g, '');
            
            // Handle basic mathematical expressions
            if (expr.includes('sin(')) {
                expr = expr.replace(/sin\(([^)]+)\)/g, (match, inner) => {
                    return Math.sin(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('cos(')) {
                expr = expr.replace(/cos\(([^)]+)\)/g, (match, inner) => {
                    return Math.cos(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('tan(')) {
                expr = expr.replace(/tan\(([^)]+)\)/g, (match, inner) => {
                    return Math.tan(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('sqrt(')) {
                expr = expr.replace(/sqrt\(([^)]+)\)/g, (match, inner) => {
                    return Math.sqrt(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('abs(')) {
                expr = expr.replace(/abs\(([^)]+)\)/g, (match, inner) => {
                    return Math.abs(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('log(')) {
                expr = expr.replace(/log\(([^)]+)\)/g, (match, inner) => {
                    return Math.log10(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('ln(')) {
                expr = expr.replace(/ln\(([^)]+)\)/g, (match, inner) => {
                    return Math.log(parseExpression(inner)).toString();
                });
            }
            if (expr.includes('exp(')) {
                expr = expr.replace(/exp\(([^)]+)\)/g, (match, inner) => {
                    return Math.exp(parseExpression(inner)).toString();
                });
            }
            
            // Handle exponentiation
            while (expr.includes('^')) {
                expr = expr.replace(/([0-9.-]+)\^([0-9.-]+)/g, (match, base, exp) => {
                    return Math.pow(parseFloat(base), parseFloat(exp)).toString();
                });
            }
            
            // Use Function constructor instead of eval (safer)
            try {
                return new Function('return ' + expr)();
            } catch (e) {
                // Fallback for simple expressions
                return parseSimpleExpression(expr);
            }
        }
        
        function parseSimpleExpression(expr) {
            // Handle very basic expressions manually
            if (/^-?[0-9.]+$/.test(expr)) {
                return parseFloat(expr);
            }
            
            // Handle x^2 specifically
            if (expr.match(/^-?[0-9.-]+\*[0-9.-]+$/)) {
                const parts = expr.split('*');
                return parseFloat(parts[0]) * parseFloat(parts[1]);
            }
            
            // For x^2 case
            const xSquaredMatch = expr.match(/^(-?[0-9.-]+)\*(-?[0-9.-]+)$/);
            if (xSquaredMatch) {
                return parseFloat(xSquaredMatch[1]) * parseFloat(xSquaredMatch[2]);
            }
            
            return NaN;
        }
        
        function drawGraph() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            draw2D();
            updateCanvasInfo();
        }
        
        function draw2D() {
            // Draw grid
            drawGrid2D();
            
            // Draw axes
            drawAxes2D();
            
            // Draw functions
            functions.forEach(func => {
                if (func.expression && func.active) {
                    drawFunction2D(func);
                }
            });
        }
        
        function drawGrid2D() {
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            
            // Calculate grid spacing based on zoom level
            const range = Math.max(viewBox.xMax - viewBox.xMin, viewBox.yMax - viewBox.yMin);
            let gridSpacing = 1;
            
            if (range > 50) gridSpacing = 10;
            else if (range > 20) gridSpacing = 5;
            else if (range > 10) gridSpacing = 2;
            else if (range > 5) gridSpacing = 1;
            else if (range > 2) gridSpacing = 0.5;
            else gridSpacing = 0.2;
            
            // Draw vertical grid lines
            const startX = Math.floor(viewBox.xMin / gridSpacing) * gridSpacing;
            for (let x = startX; x <= viewBox.xMax; x += gridSpacing) {
                const screenX = ((x - viewBox.xMin) / (viewBox.xMax - viewBox.xMin)) * canvas.width;
                if (screenX >= 0 && screenX <= canvas.width) {
                    ctx.beginPath();
                    ctx.moveTo(screenX, 0);
                    ctx.lineTo(screenX, canvas.height);
                    ctx.stroke();
                }
            }
            
            // Draw horizontal grid lines
            const startY = Math.floor(viewBox.yMin / gridSpacing) * gridSpacing;
            for (let y = startY; y <= viewBox.yMax; y += gridSpacing) {
                const screenY = canvas.height - ((y - viewBox.yMin) / (viewBox.yMax - viewBox.yMin)) * canvas.height;
                if (screenY >= 0 && screenY <= canvas.height) {
                    ctx.beginPath();
                    ctx.moveTo(0, screenY);
                    ctx.lineTo(canvas.width, screenY);
                    ctx.stroke();
                }
            }
        }
        
        function drawAxes2D() {
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // X-axis
            if (viewBox.yMin <= 0 && viewBox.yMax >= 0) {
                const y = canvas.height - ((0 - viewBox.yMin) / (viewBox.yMax - viewBox.yMin)) * canvas.height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Y-axis
            if (viewBox.xMin <= 0 && viewBox.xMax >= 0) {
                const x = ((0 - viewBox.xMin) / (viewBox.xMax - viewBox.xMin)) * canvas.width;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
        }
        
        function drawFunction2D(func) {
            console.log('Drawing function:', func.expression, 'with color:', func.color);
            
            ctx.strokeStyle = func.color;
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.beginPath();
            let firstPoint = true;
            const numPoints = 1000; // More points for smoother curves
            const step = (viewBox.xMax - viewBox.xMin) / numPoints;
            
            for (let i = 0; i <= numPoints; i++) {
                const x = viewBox.xMin + i * step;
                const y = evaluateExpression(func.expression, x);
                
                if (!isNaN(y) && isFinite(y)) {
                    const screenX = ((x - viewBox.xMin) / (viewBox.xMax - viewBox.xMin)) * canvas.width;
                    const screenY = canvas.height - ((y - viewBox.yMin) / (viewBox.yMax - viewBox.yMin)) * canvas.height;
                    
                    if (firstPoint) {
                        ctx.moveTo(screenX, screenY);
                        firstPoint = false;
                        console.log('First point at:', screenX, screenY, 'for x=', x, 'y=', y);
                    } else {
                        ctx.lineTo(screenX, screenY);
                    }
                } else {
                    firstPoint = true;
                }
            }
            
            ctx.stroke();
            console.log('Function drawn');
        }
        

        
        function updateCanvasInfo() {
            const info = document.getElementById('canvasInfo');
            const activeCount = functions.filter(f => f.expression && f.active).length;
            info.textContent = `Functions: ${activeCount} | Zoom: ${zoom.toFixed(1)}x`;
        }
        
        // Initialize the calculator
        document.addEventListener('DOMContentLoaded', function() {
            initCanvas();
            updateDeleteButtons();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9703c72710a1cfc0',t:'MTc1NTM3NzE1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
